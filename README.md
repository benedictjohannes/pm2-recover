# PM2 Dev Mode Recovery Utility

## Description:
Generates shell commands to accurately recreate PM2 processes based on a dump file.

Unlike `pm2 resurrect` or `pm2 update`, this tries to recreate pm2 processes **WITHOUT** carrying over old environments (env setting or nodeJS absolute paths). 

This is useful to recreate the pm2 processes, like after switching NVM version.

## Usage:
- `npx pm2-recover [OPTIONS]`
- `node pm2-recover.js [OPTIONS]` (running directly)

## Options:
- `-f`, `--dumpFile` `<path>`: (Optional) Specify a custom PM2 dump file path. Defaults to `~/.pm2/dump.pm2`.
- `-o`, `--outFile` `<path>`: (Optional) Write generated commands to a file instead of stdout.
- `-h`, `--help`: (Optional) Prints a help message.

## Features:
- Preserves stopped process status: Processes with status `stopped` are started then immediately stopped.
- Preserves watch mode: The `--watch` flag is added if defined in the original configuration.
- Ignore old node paths: Switches `nvm` managed old absolute Node paths to generic commands for environment flexibility.
- Recreate the process with the same the original working directory.

Notes:
- To switch nvm managed node version, ensure when you run the generated script, you're using the desired node version as `pm2` keeps track of absolute path to the node executable.
- The process reads from `pm2` dump files, _not_ from current active process list. Ensure you've run `pm2 save` _before_ you run `npx pm2-recover`.

## Example:

You can run `npx pm2-recover` (or `node pm2-recover.js`) and pipe its output to `bash` after reviewing, or save it to a file.
- `npx pm2-recover -f /path/to/custom-pm2-dump.json`: custom dump.pm2 path
- `npx pm2-recover -o recovery-script.sh`: writes the output to a file
- `npx pm2-recover | bash`: directly try to execute the output by piping to bash. Make sure you've inspected the output beforehand.

Here's an anonymized output from `npx pm2-recover` straight from my own dev machine:

```bash

#!/bin/bash
# --- PM2 Relaunch Commands Generated by pm2-recover ---
# Input File: /home/developer/.pm2/dump.pm2
# Structure: pm2 start --name NAME COMMAND [OPTIONS] -- ARGS

# Sets bash to stop script execution immediately after error
set -euo pipefail
# Execute pm2 kill first to ensure pm2 is processes would be created fresh, skip this line if you don't need to.
pm2 kill || true

# [Shell-Wrapped] Process: web-client
cd "/path/to/project/web-client" && pm2 start --name web-client  'npm run dev'

# [Shell-Wrapped] Process: api-gateway
cd "/path/to/project/api-gateway" && pm2 start --name api-gateway  'gow run .'

# [Shell-Wrapped] Process: data-processor
cd "/path/to/project/data-processor" && pm2 start --name data-processor  'bun consume:events'
pm2 stop data-processor

# [Shell-Wrapped] Process: analytics-backend
cd "/path/to/project/analytics-backend" && pm2 start --name analytics-backend  'npm run start:dev'

# [Shell-Wrapped] Process: content-editor
cd "/path/to/project/content-editor" && pm2 start --name content-editor 'npx parcel public/*.html --port 1234'
pm2 stop content-editor

# [Direct Exec] Process: auth-service
cd "/path/to/project/authService/entrypoints" && pm2 start --name auth-service  './auth-middleware' -- '--config' 'original.yaml'

# --- FINALIZATION ---
pm2 save
pm2 list
```